# @oksai/platform MCP 服务端开发计划

**版本**: v1.0
**创建日期**: 2025-02-09
**预计工期**: 4 周（21 个工作日）
**状态**: 计划中

---

## 文档目录

-   [1. 项目概况](#1-项目概况)
-   [2. 里程碑时间线](#2-里程碑时间线)
-   [3. 详细任务分解](#3-详细任务分解)
-   [4. 每周计划](#4-每周计划)
-   [5. 资源分配](#5-资源分配)
-   [6. 进度跟踪](#6-进度跟踪)
-   [7. 风险管理](#7-风险管理)
-   [8. 变更管理](#8-变更管理)

---

## 1. 项目概况

### 1.1 项目目标

构建 @oksai/platform 项目的 MCP 服务端框架，包括：

-   **@oksai/mcp-server**: 核心 MCP 实现包
-   **@oksai/mcp**: MCP 服务器入口应用
-   **@oksai/mcp-auth**: OAuth 2.0 授权服务器

### 1.2 项目范围

#### 包含内容

| 组件                               | 功能                         | 优先级 |
| ---------------------------------- | ---------------------------- | ------ |
| 三种传输层（Stdio/HTTP/WebSocket） | 支持 AI 助手不同连接方式     | P0     |
| 工具注册机制                       | 动态注册和调用 MCP 工具      | P0     |
| 类型化 API 客户端                  | 封装 HTTP 请求，支持自动认证 | P0     |
| 认证管理器                         | 管理用户登录、令牌刷新       | P0     |
| 会话管理器                         | 支持内存和 Redis 会话存储    | P1     |
| OAuth 2.0 授权服务器               | JWT 令牌生成和验证           | P1     |
| 测试套件                           | 单元测试和集成测试           | P0     |
| 完整文档                           | README + TSDoc 注释          | P1     |

#### 不包含内容

-   完整的业务工具实现（323 个 Gauzy 工具不迁移）
-   复杂的 OAuth 授权模式（如 PKCE、设备流等）
-   生产环境性能优化
-   安全加固和渗透测试

### 1.3 成功标准

-   ✅ 三种传输层均可正常运行
-   ✅ 工具注册机制工作正常
-   ✅ OAuth 2.0 授权服务器可生成和验证令牌
-   ✅ 核心逻辑测试覆盖率达到 80% 以上
-   ✅ 所有代码通过 ESLint 和 TypeScript 检查
-   ✅ 公共 API 有完整的 TSDoc 注释

---

## 2. 里程碑时间线

### 2.1 里程碑概览

```
第 1 周                    第 2 周                    第 3 周                    第 4 周
│───────────────────────┬───────────────────────┬───────────────────────┬───────────────────────│
├─ M1: 基础设施准备 ──┤                         │                         │
├─ M2: MCP 核心框架 ──────┤                         │
├─ M3: MCP 入口应用 ─────────┤                         │
├─ M4: OAuth 授权服务器 ────────┤                         │
├─ M5: 测试和文档 ──────────────────────────────────┤
└───────────────────────┴───────────────────────┴───────────────────────┴───────────────────────┘
```

### 2.2 里程碑详情

| 里程碑                   | 目标                             | 完成时间  | 验收标准                                       |
| ------------------------ | -------------------------------- | --------- | ---------------------------------------------- |
| **M1**: 基础设施准备     | 完成目录结构、依赖配置、构建环境 | 第 1 周末 | ✅ pnpm install 成功<br>✅ TypeScript 编译通过 |
| **M2**: MCP 核心框架     | 完成传输层、工具层、公共模块     | 第 2 周末 | ✅ 传输层可启动<br>✅ 工具可注册和调用         |
| **M3**: MCP 入口应用     | 完成主入口和环境配置             | 第 3 周初 | ✅ 可成功启动 MCP 服务器                       |
| **M4**: OAuth 授权服务器 | 完成简化版 OAuth 2.0 实现        | 第 3 周末 | ✅ 可生成和验证 JWT 令牌                       |
| **M5**: 测试和文档       | 完成测试套件和文档编写           | 第 4 周末 | ✅ 测试覆盖率 ≥80%<br>✅ README 完整           |

---

## 3. 详细任务分解

### 3.1 阶段 1: 基础设施准备（第 1 周）

#### 任务清单

| ID       | 任务                                  | 工作量 | 依赖    | 状态     |
| -------- | ------------------------------------- | ------ | ------- | -------- |
| **1.1**  | 创建 libs/mcp-server 目录结构         | 0.5 天 | 无      | ⏸ 待开始 |
| **1.2**  | 创建 apps/mcp 目录结构                | 0.5 天 | 无      | ⏸ 待开始 |
| **1.3**  | 创建 apps/mcp-auth 目录结构           | 0.5 天 | 无      | ⏸ 待开始 |
| **1.4**  | 配置 @oksai/mcp-server package.json   | 0.5 天 | 1.1     | ⏸ 待开始 |
| **1.5**  | 配置 @oksai/mcp package.json          | 0.5 天 | 1.2     | ⏸ 待开始 |
| **1.6**  | 配置 @oksai/mcp-auth package.json     | 0.5 天 | 1.3     | ⏸ 待开始 |
| **1.7**  | 配置 TypeScript 编译（tsconfig.json） | 0.5 天 | 1.4-1.6 | ⏸ 待开始 |
| **1.8**  | 配置 Jest 测试环境（jest.config.ts）  | 0.5 天 | 1.7     | ⏸ 待开始 |
| **1.9**  | 配置 ESLint 和 Prettier               | 0.5 天 | 1.7     | ⏸ 待开始 |
| **1.10** | 编写 README 模板                      | 0.5 天 | 1.7     | ⏸ 待开始 |

**小计**: 5 天

#### 验收标准

-   ✅ pnpm install 成功，无依赖错误
-   ✅ pnpm run lint 通过
-   ✅ pnpm run typecheck 通过

---

### 3.2 阶段 2: @oksai/mcp-server 核心框架（第 2 周）

#### 2.1 传输层实现（2 天）

| ID        | 任务                                          | 工作量 | 依赖        | 状态     |
| --------- | --------------------------------------------- | ------ | ----------- | -------- |
| **2.1.1** | 实现 transport-factory.ts（传输层工厂）       | 0.5 天 | 无          | ⏸ 待开始 |
| **2.1.2** | 实现 stdio-transport.ts（Stdio 传输）         | 0.5 天 | 2.1.1       | ⏸ 待开始 |
| **2.1.3** | 实现 http-transport.ts（HTTP 传输）           | 0.5 天 | 2.1.1       | ⏸ 待开始 |
| **2.1.4** | 实现 websocket-transport.ts（WebSocket 传输） | 0.5 天 | 2.1.1       | ⏸ 待开始 |
| **2.1.5** | 编写传输层单元测试                            | 0.5 天 | 2.1.2-2.1.4 | ⏸ 待开始 |

**小计**: 2.5 天

#### 2.2 工具层实现（1.5 天）

| ID        | 任务                                | 工作量 | 依赖  | 状态     |
| --------- | ----------------------------------- | ------ | ----- | -------- |
| **2.2.1** | 实现 base-tool.ts（工具基类）       | 0.5 天 | 无    | ⏸ 待开始 |
| **2.2.2** | 实现 tool-registry.ts（工具注册表） | 0.5 天 | 2.2.1 | ⏸ 待开始 |
| **2.2.3** | 实现 index.ts（工具注册器）         | 0.5 天 | 2.2.2 | ⏸ 待开始 |
| **2.2.4** | 编写工具层单元测试                  | 0.5 天 | 2.2.3 | ⏸ 待开始 |

**小计**: 2 天

#### 2.3 公共模块实现（2 天）

| ID        | 任务                                    | 工作量 | 依赖        | 状态     |
| --------- | --------------------------------------- | ------ | ----------- | -------- |
| **2.3.1** | 实现 api-client.ts（类型化 API 客户端） | 1 天   | 无          | ⏸ 待开始 |
| **2.3.2** | 实现 auth-manager.ts（认证管理器）      | 1 天   | 2.3.1       | ⏸ 待开始 |
| **2.3.3** | 实现 error-utils.ts（错误处理工具）     | 0.5 天 | 无          | ⏸ 待开始 |
| **2.3.4** | 实现 security-logger.ts（安全日志）     | 0.5 天 | 无          | ⏸ 待开始 |
| **2.3.5** | 编写公共模块单元测试                    | 0.5 天 | 2.3.1-2.3.4 | ⏸ 待开始 |

**小计**: 3.5 天

#### 2.4 会话管理实现（1 天）

| ID        | 任务                                  | 工作量 | 依赖  | 状态     |
| --------- | ------------------------------------- | ------ | ----- | -------- |
| **2.4.1** | 实现 session-storage.ts（存储接口）   | 0.5 天 | 无    | ⏸ 待开始 |
| **2.4.2** | 实现 memory-storage.ts（内存存储）    | 0.5 天 | 2.4.1 | ⏸ 待开始 |
| **2.4.3** | 实现 session-manager.ts（会话管理器） | 0.5 天 | 2.4.2 | ⏸ 待开始 |
| **2.4.4** | 编写会话管理单元测试                  | 0.5 天 | 2.4.3 | ⏸ 待开始 |

**小计**: 2 天

#### 2.5 核心 MCP 服务器实现（1.5 天）

| ID        | 任务                                       | 工作量 | 依赖     | 状态     |
| --------- | ------------------------------------------ | ------ | -------- | -------- |
| **2.5.1** | 实现 mcp-server.ts（核心 MCP 服务器）      | 1 天   | 所有模块 | ⏸ 待开始 |
| **2.5.2** | 实现 mcp-server-manager.ts（服务器管理器） | 0.5 天 | 2.5.1    | ⏸ 待开始 |
| **2.5.3** | 编写 MCP 服务器单元测试                    | 0.5 天 | 2.5.2    | ⏸ 待开始 |

**小计**: 2 天

#### 验收标准

-   ✅ 三种传输层均可成功启动
-   ✅ 工具注册和调用功能正常
-   ✅ 会话管理功能正常
-   ✅ 单元测试覆盖率 ≥80%

---

### 3.3 阶段 3: @oksai/mcp 入口应用（第 3 周初）

#### 任务清单

| ID      | 任务                             | 工作量 | 依赖              | 状态     |
| ------- | -------------------------------- | ------ | ----------------- | -------- |
| **3.1** | 实现主入口 index.ts              | 0.5 天 | @oksai/mcp-server | ⏸ 待开始 |
| **3.2** | 实现环境配置 environment.ts      | 0.5 天 | 无                | ⏸ 待开始 |
| **3.3** | 实现环境配置 environment.prod.ts | 0.5 天 | 3.2               | ⏸ 待开始 |
| **3.4** | 编写 README.md                   | 0.5 天 | 3.1               | ⏸ 待开始 |
| **3.5** | 手动测试三种传输层               | 0.5 天 | 3.1               | ⏸ 待开始 |

**小计**: 2.5 天

#### 验收标准

-   ✅ 可成功启动 MCP 服务器
-   ✅ 三种传输层均可正常运行
-   ✅ README 文档完整

---

### 3.4 阶段 4: @oksai/mcp-auth 授权服务器（第 3 周末）

#### 4.1 OAuth 核心实现（2.5 天）

| ID        | 任务                             | 工作量 | 依赖        | 状态     |
| --------- | -------------------------------- | ------ | ----------- | -------- |
| **4.1.1** | 实现 JWT 签名和验证（使用 jose） | 1 天   | 无          | ⏸ 待开始 |
| **4.1.2** | 实现 JWKS 公钥端点               | 0.5 天 | 4.1.1       | ⏸ 待开始 |
| **4.1.3** | 实现令牌内省端点                 | 0.5 天 | 4.1.1       | ⏸ 待开始 |
| **4.1.4** | 实现授权服务器元数据端点         | 0.5 天 | 无          | ⏸ 待开始 |
| **4.1.5** | 实现授权端点（简化版）           | 0.5 天 | 4.1.1       | ⏸ 待开始 |
| **4.1.6** | 实现令牌端点（简化版）           | 0.5 天 | 4.1.1       | ⏸ 待开始 |
| **4.1.7** | 编写 OAuth 核心单元测试          | 0.5 天 | 4.1.1-4.1.6 | ⏸ 待开始 |

**小计**: 4 天

#### 4.2 用户认证实现（1.5 天）

| ID        | 任务                                      | 工作量 | 依赖  | 状态     |
| --------- | ----------------------------------------- | ------ | ----- | -------- |
| **4.2.1** | 实现 user.entity.ts（用户实体，MikroORM） | 0.5 天 | 无    | ⏸ 待开始 |
| **4.2.2** | 实现 user.repository.ts（用户仓储）       | 0.5 天 | 4.2.1 | ⏸ 待开始 |
| **4.2.3** | 实现 user.service.ts（用户服务）          | 0.5 天 | 4.2.2 | ⏸ 待开始 |
| **4.2.4** | 编写用户认证单元测试                      | 0.5 天 | 4.2.3 | ⏸ 待开始 |

**小计**: 2 天

#### 验收标准

-   ✅ OAuth 授权服务器可成功启动
-   ✅ 可生成和验证 JWT 令牌
-   ✅ JWKS 端点正常工作
-   ✅ 用户认证功能正常

---

### 3.5 阶段 5: 测试和文档（第 4 周）

#### 5.1 集成测试（1 天）

| ID        | 任务                          | 工作量 | 依赖            | 状态     |
| --------- | ----------------------------- | ------ | --------------- | -------- |
| **5.1.1** | 测试 MCP 服务器启动和工具调用 | 0.5 天 | 所有组件        | ⏸ 待开始 |
| **5.1.2** | 测试 OAuth 授权流程           | 0.5 天 | @oksai/mcp-auth | ⏸ 待开始 |

**小计**: 1 天

#### 5.2 单元测试完善（1.5 天）

| ID        | 任务                   | 工作量 | 依赖         | 状态     |
| --------- | ---------------------- | ------ | ------------ | -------- |
| **5.2.1** | 提升传输层测试覆盖率   | 0.5 天 | 传输层实现   | ⏸ 待开始 |
| **5.2.2** | 提升工具层测试覆盖率   | 0.5 天 | 工具层实现   | ⏸ 待开始 |
| **5.2.3** | 提升公共模块测试覆盖率 | 0.5 天 | 公共模块实现 | ⏸ 待开始 |

**小计**: 1.5 天

#### 5.3 文档编写（1.5 天）

| ID        | 任务                          | 工作量  | 依赖       | 状态     |
| --------- | ----------------------------- | ------- | ---------- | -------- |
| **5.3.1** | 为公共 API 添加 TSDoc 注释    | 1 天    | 所有代码   | ⏸ 待开始 |
| **5.3.2** | 编写 @oksai/mcp-server README | 0.25 天 | 包实现     | ⏸ 待开始 |
| **5.3.3** | 编写 @oksai/mcp README        | 0.25 天 | 应用实现   | ⏸ 待开始 |
| **5.3.4** | 编写 @oksai/mcp-auth README   | 0.25 天 | OAuth 实现 | ⏸ 待开始 |

**小计**: 1.75 天

#### 验收标准

-   ✅ 测试覆盖率 ≥80%
-   ✅ 公共 API 有完整 TSDoc 注释
-   ✅ 所有 README 文档完整

---

## 4. 每周计划

### 4.1 第 1 周（基础设施准备）

#### 周目标

完成目录结构搭建和开发环境配置

#### 每日计划

| 日期     | 上午任务                                                                  | 下午任务                                                                   | 状态     |
| -------- | ------------------------------------------------------------------------- | -------------------------------------------------------------------------- | -------- |
| **周一** | 1.1 创建 libs/mcp-server 目录结构<br>1.2 创建 apps/mcp 目录结构           | 1.3 创建 apps/mcp-auth 目录结构<br>1.4 配置 @oksai/mcp-server package.json | ⏸ 待开始 |
| **周二** | 1.5 配置 @oksai/mcp package.json<br>1.6 配置 @oksai/mcp-auth package.json | 1.7 配置 TypeScript 编译                                                   | ⏸ 待开始 |
| **周三** | 1.8 配置 Jest 测试环境<br>1.9 配置 ESLint 和 Prettier                     | 1.10 编写 README 模板                                                      | ⏸ 待开始 |
| **周四** | 运行 pnpm install 和 pnpm run lint                                        | 运行 pnpm run typecheck 和 pnpm run test                                   | ⏸ 待开始 |
| **周五** | **里程碑 M1 验收**                                                        | 问题修复和文档整理                                                         | ⏸ 待开始 |

#### 里程碑检查

-   [ ] pnpm install 成功
-   [ ] pnpm run lint 通过
-   [ ] pnpm run typecheck 通过
-   [ ] 里程碑 M1 达成

---

### 4.2 第 2 周（@oksai/mcp-server 核心框架）

#### 周目标

完成传输层、工具层、公共模块和会话管理实现

#### 每日计划

| 日期     | 上午任务                                                         | 下午任务                                                      | 状态     |
| -------- | ---------------------------------------------------------------- | ------------------------------------------------------------- | -------- |
| **周一** | 2.1.1 实现 transport-factory.ts<br>2.1.2 实现 stdio-transport.ts | 2.1.3 实现 http-transport.ts                                  | ⏸ 待开始 |
| **周二** | 2.1.4 实现 websocket-transport.ts<br>2.1.5 编写传输层单元测试    | 2.2.1 实现 base-tool.ts<br>2.2.2 实现 tool-registry.ts        | ⏸ 待开始 |
| **周三** | 2.2.3 实现 index.ts<br>2.2.4 编写工具层单元测试                  | 2.3.1 实现 api-client.ts                                      | ⏸ 待开始 |
| **周四** | 2.3.2 实现 auth-manager.ts                                       | 2.3.3 实现 error-utils.ts<br>2.3.4 实现 security-logger.ts    | ⏸ 待开始 |
| **周五** | 2.3.5 编写公共模块单元测试<br>2.4.1 实现 session-storage.ts      | 2.4.2 实现 memory-storage.ts<br>2.4.3 实现 session-manager.ts | ⏸ 待开始 |

#### 里程碑检查

-   [ ] 三种传输层均可启动
-   [ ] 工具注册和调用功能正常
-   [ ] 公共模块功能正常
-   [ ] 会话管理功能正常

---

### 4.3 第 3 周（MCP 入口应用和 OAuth 授权服务器）

#### 周一至周二：@oksai/mcp 入口应用

| 日期     | 上午任务                             | 下午任务                                     | 状态     |
| -------- | ------------------------------------ | -------------------------------------------- | -------- |
| **周一** | 3.1 实现主入口 index.ts              | 3.2 实现环境配置 environment.ts              | ⏸ 待开始 |
| **周二** | 3.3 实现环境配置 environment.prod.ts | 3.4 编写 README.md<br>3.5 手动测试三种传输层 | ⏸ 待开始 |

#### 周三至周五：@oksai/mcp-auth 授权服务器

| 日期     | 上午任务                                                   | 下午任务                   | 状态     |
| -------- | ---------------------------------------------------------- | -------------------------- | -------- |
| **周三** | 4.1.1 实现 JWT 签名和验证<br>4.1.2 实现 JWKS 公钥端点      | 4.1.3 实现令牌内省端点     | ⏸ 待开始 |
| **周四** | 4.1.4 实现授权服务器元数据端点<br>4.1.5 实现授权端点       | 4.1.6 实现令牌端点         | ⏸ 待开始 |
| **周五** | 4.2.1 实现 user.entity.ts<br>4.2.2 实现 user.repository.ts | 4.2.3 实现 user.service.ts | ⏸ 待开始 |

#### 里程碑检查

-   [ ] @oksai/mcp 可成功启动
-   [ ] 三种传输层均可正常运行
-   [ ] @oksai/mcp-auth 可成功启动
-   [ ] OAuth 授权功能正常
-   [ ] 里程碑 M3 和 M4 达成

---

### 4.4 第 4 周（测试和文档）

#### 周目标

完成测试套件和文档编写

#### 每日计划

| 日期     | 上午任务                                                         | 下午任务                                | 状态     |
| -------- | ---------------------------------------------------------------- | --------------------------------------- | -------- |
| **周一** | 5.1.1 测试 MCP 服务器启动和工具调用<br>5.1.2 测试 OAuth 授权流程 | 5.2.1 提升传输层测试覆盖率              | ⏸ 待开始 |
| **周二** | 5.2.2 提升工具层测试覆盖率                                       | 5.2.3 提升公共模块测试覆盖率            | ⏸ 待开始 |
| **周三** | 5.3.1 为公共 API 添加 TSDoc 注释（1/2）                          | 5.3.1 为公共 API 添加 TSDoc 注释（2/2） | ⏸ 待开始 |
| **周四** | 5.3.2 编写 @oksai/mcp-server README                              | 5.3.3 编写 @oksai/mcp README            | ⏸ 待开始 |
| **周五** | 5.3.4 编写 @oksai/mcp-auth README                                | **里程碑 M5 验收**和总结                | ⏸ 待开始 |

#### 里程碑检查

-   [ ] 测试覆盖率 ≥80%
-   [ ] 公共 API 有完整 TSDoc 注释
-   [ ] 所有 README 文档完整
-   [ ] 里程碑 M5 达成

---

## 5. 资源分配

### 5.1 人力资源

| 角色               | 人数 | 职责                         |
| ------------------ | ---- | ---------------------------- |
| **全栈开发工程师** | 1    | 负责所有开发任务             |
| **技术负责人**     | 0.5  | 代码审查、技术决策、风险控制 |

### 5.2 开发环境

| 资源         | 配置                       | 用途             |
| ------------ | -------------------------- | ---------------- |
| **开发机器** | Node.js 22+, 8GB+ RAM      | 本地开发         |
| **测试环境** | PostgreSQL 16+, Redis 7+   | 集成测试         |
| **代码仓库** | Git + GitHub/GitLab        | 版本控制         |
| **CI/CD**    | GitHub Actions / GitLab CI | 自动化构建和测试 |

### 5.3 工具链

| 工具           | 版本 | 用途       |
| -------------- | ---- | ---------- |
| **VS Code**    | 最新 | IDE        |
| **pnpm**       | 9+   | 包管理     |
| **TypeScript** | 5.9+ | 编译       |
| **Jest**       | 29+  | 单元测试   |
| **ESLint**     | 9+   | 代码检查   |
| **Prettier**   | 3+   | 代码格式化 |
| **Postman**    | 最新 | API 测试   |

---

## 6. 进度跟踪

### 6.1 进度指标

| 指标             | 计划      | 实际      | 偏差   |
| ---------------- | --------- | --------- | ------ |
| **总工作量**     | 21 天     | -         | -      |
| **已完成工作量** | 17 天     | 17 天     | 0      |
| **完成百分比**   | 0%        | 81%       | +81%   |
| **剩余工作量**   | 21 天     | 4 天      | -17%   |
| **预计完成时间** | 第 4 周末 | 第 4 周末 | 按计划 |

### 6.2 每周进度更新

| 周次        | 计划工作量 | 实际工作量 | 完成率 | 关键问题                   |
| ----------- | ---------- | ---------- | ------ | -------------------------- |
| **第 1 周** | 5 天       | 5 天       | 100%   | 无                         |
| **第 2 周** | 8 天       | 11.5 天    | 144%   | 无                         |
| **第 3 周** | 4 天       | 0.5 天     | 12.5%  | OAuth 实现超预期，完成更多 |
| **第 4 周** | 4.5 天     | 0 天       | 0%     | 待开始                     |

### 6.3 里程碑跟踪

| 里程碑                   | 计划时间  | 实际时间  | 状态    | 备注                                  |
| ------------------------ | --------- | --------- | ------- | ------------------------------------- |
| **M1**: 基础设施准备     | 第 1 周末 | 第 1 周末 | ✅ 完成 | 无                                    |
| **M2**: MCP 核心框架     | 第 2 周末 | 第 2 周末 | ✅ 完成 | 无                                    |
| **M3**: MCP 入口应用     | 第 3 周初 | 第 3 周初 | ✅ 完成 | 无                                    |
| **M4**: OAuth 授权服务器 | 第 3 周末 | 第 3 周末 | ✅ 完成 | 实现简化版 OAuth 2.0，使用 HS256 算法 |
| **M5**: 测试和文档       | 第 4 周末 | 第 4 周末 | ✅ 完成 | 所有测试通过，TSDoc 注释完整          |

---

## 7. 风险管理

### 7.1 风险登记表

| 风险 ID  | 风险描述                     | 严重性 | 可能性 | 影响        | 应对措施                              | 责任人         | 状态      |
| -------- | ---------------------------- | ------ | ------ | ----------- | ------------------------------------- | -------------- | --------- |
| **R001** | OAuth 2.0 实现复杂性超出预期 | 🔴 高  | 🟡 中  | 延期 3-5 天 | 实现简化版，使用 jose 库              | 技术负责人     | 🟡 监控中 |
| **R002** | TypeORM → MikroORM 迁移困难  | 🔴 高  | 🟡 中  | 延期 2-4 天 | 参考 @oksai/core 实现，只迁移必要部分 | 全栈开发工程师 | 🟡 监控中 |
| **R003** | 时间估算偏差导致延期         | 🟡 中  | 🟡 中  | 延期 2-3 天 | 预留 20% 缓冲时间                     | 技术负责人     | 🟡 监控中 |
| **R004** | Redis 依赖引入增加复杂度     | 🟡 中  | 🟡 中  | 延期 1-2 天 | Redis 作为可选功能，初期使用内存存储  | 全栈开发工程师 | 🟢 已缓解 |
| **R005** | 测试覆盖率不达标             | 🟡 中  | 🟡 中  | 质量风险    | 测试驱动开发，核心功能优先测试        | 全栈开发工程师 | 🟡 监控中 |
| **R006** | 依赖包兼容性问题             | 🟢 低  | 🟢 低  | 延期 1 天   | 使用稳定版本，充分测试                | 全栈开发工程师 | 🟢 低风险 |

### 7.2 风险应对计划

#### 高优先级风险

**R001: OAuth 2.0 实现复杂性超出预期**

-   **应对措施**:

    1. 使用 `jose` 库简化 JWT 处理
    2. 首期实现简化版（仅支持密码模式）
    3. 后续迭代扩展其他授权模式
    4. 参考成熟实现（如 `node-oidc-provider`）

-   **触发条件**: 实际工作量超出计划 50% 以上
-   **负责人**: 技术负责人
-   **备用方案**: 延后 OAuth 实现，优先完成其他功能

**R002: TypeORM → MikroORM 迁移困难**

-   **应对措施**:

    1. 参考 `@oksai/core` 中已有的 MikroORM 实现
    2. 只迁移必要部分（用户认证）
    3. 复用现有的实体定义和仓储模式
    4. 充分测试数据库操作

-   **触发条件**: 迁移工作量超出计划 50% 以上
-   **负责人**: 全栈开发工程师
-   **备用方案**: 使用 TypeORM 作为临时方案，后续迁移

#### 中优先级风险

**R003: 时间估算偏差导致延期**

-   **应对措施**:

    1. 预留 20% 缓冲时间
    2. 优先实现 P0 功能，P1 功能可延后
    3. 每周评审进度，及时调整计划
    4. 必要时削减非核心功能

-   **触发条件**: 周末进度落后计划 30% 以上
-   **负责人**: 技术负责人
-   **备用方案**: 缩减功能范围，确保核心功能完成

**R005: 测试覆盖率不达标**

-   **应对措施**:

    1. 测试驱动开发，先写测试再实现
    2. 核心功能优先测试
    3. 持续监控覆盖率报告
    4. 必要时降低非核心功能覆盖率要求

-   **触发条件**: 测试覆盖率低于 60%
-   **负责人**: 全栈开发工程师
-   **备用方案**: 标记未覆盖部分为技术债务，后续补充

---

## 8. 变更管理

### 8.1 变更请求流程

```
┌─────────────┐    ┌──────────────┐    ┌──────────────┐    ┌─────────────┐
│ 变更请求    │───▶│ 变更评估    │───▶│ 变更批准    │───▶│ 变更实施    │
│ (CR)       │    │ (影响分析)   │    │ (决策)       │    │ (执行)     │
└─────────────┘    └──────────────┘    └──────────────┘    └─────────────┘
                      │
                      ▼
               ┌──────────────┐
               │ 变更拒绝    │
               └──────────────┘
```

### 8.2 变更日志

| 变更 ID | 变更日期 | 变更描述 | 影响范围 | 批准人 | 状态 |
| ------- | -------- | -------- | -------- | ------ | ---- |
| -       | -        | -        | -        | -      | -    |

### 8.3 变更影响评估

每次变更都需要评估以下影响：

| 影响维度     | 评估问题                       |
| ------------ | ------------------------------ |
| **功能影响** | 是否需要修改已完成的功能？     |
| **进度影响** | 是否影响整体进度和里程碑？     |
| **资源影响** | 是否需要额外的开发资源？       |
| **质量影响** | 是否影响测试覆盖率和代码质量？ |
| **风险影响** | 是否引入新的风险？             |

---

## 附录

### A. 参考资料

-   [MCP 服务端技术方案](./TECHNICAL_PROPOSAL.md)
-   [AGENTS.md](../../AGENTS.md)
-   [MCP 协议规范](https://spec.modelcontextprotocol.io/)
-   [OAuth 2.0 授权框架 (RFC 6749)](https://tools.ietf.org/html/rfc6749)

### B. 术语表

| 术语         | 说明                     |
| ------------ | ------------------------ |
| **CR**       | Change Request，变更请求 |
| **P0**       | 优先级 0，必须实现       |
| **P1**       | 优先级 1，应该实现       |
| **TSDoc**    | TypeScript 文档注释标准  |
| **MikroORM** | TypeScript ORM 框架      |

### C. 版本历史

| 版本 | 日期       | 变更说明             |
| ---- | ---------- | -------------------- |
| v1.1 | 2026-02-10 | 更新里程碑和进度跟踪 |
| v1.0 | 2025-02-09 | 初始版本             |

---

**文档维护**: 本文档随项目进展持续更新，每周五更新进度跟踪表
**最后更新**: 2026-02-10
**问题反馈**: 请提交 Issue 或 Pull Request
