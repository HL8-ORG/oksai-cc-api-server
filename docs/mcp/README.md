# @oksai/platform MCP 服务端文档

本目录包含 @oksai/platform MCP 服务端框架的技术方案和开发计划文档。

---

## 文档列表

### 1. 技术方案 ([TECHNICAL_PROPOSAL.md](./TECHNICAL_PROPOSAL.md))

**概述**: MCP 服务端框架的完整技术设计方案

**包含内容**:

-   项目概述和背景
-   目标与范围界定
-   整体技术架构设计
-   三个核心组件的详细设计（@oksai/mcp-server、@oksai/mcp、@oksai/mcp-auth）
-   技术选型理由
-   成功标准定义

**目标读者**: 技术负责人、架构师、开发工程师

**更新频率**: 阶段更新

---

### 2. 开发计划 ([DEVELOPMENT_PLAN.md](./DEVELOPMENT_PLAN.md))

**概述**: MCP 服务端框架的详细开发计划和进度跟踪

**包含内容**:

-   项目概况和成功标准
-   五个里程碑时间线
-   详细的任务分解（共 21 天工作量）
-   每周每日计划
-   资源分配（人力、环境、工具链）
-   进度跟踪指标
-   风险管理和应对措施
-   变更管理流程

**目标读者**: 项目经理、开发工程师、技术负责人

**更新频率**: 每周五更新进度跟踪表

---

## 项目目标

构建 @oksai/platform 项目的 MCP 服务端框架，包括三个核心组件：

| 组件                  | 路径               | 功能                                                     |
| --------------------- | ------------------ | -------------------------------------------------------- |
| **@oksai/mcp-server** | `libs/mcp-server/` | 核心 MCP 实现包，提供工具注册、传输层、会话管理等功能    |
| **@oksai/mcp**        | `apps/mcp/`        | MCP 服务器入口应用，支持 Stdio/HTTP/WebSocket 三种传输层 |
| **@oksai/mcp-auth**   | `apps/mcp-auth/`   | OAuth 2.0 授权服务器，提供 JWT 令牌生成和验证            |

---

## 核心功能

### P0 优先级（必须实现）

-   ✅ 三种传输层（Stdio、HTTP、WebSocket）
-   ✅ 工具注册和调用机制
-   ✅ 类型化 API 客户端
-   ✅ 认证管理器
-   ✅ 测试套件（覆盖率 ≥80%）

### P1 优先级（应该实现）

-   ✅ 会话管理器（内存 + Redis 可选）
-   ✅ OAuth 2.0 授权服务器（简化版）
-   ✅ 完整文档（README + TSDoc）

---

## 时间线

| 阶段       | 时间    | 目标                                   | 里程碑 | 状态     |
| ---------- | ------- | -------------------------------------- | ------ | -------- |
| **阶段 1** | 第 1 周 | 基础设施准备                           | M1     | ✅ 完成  |
| **阶段 2** | 第 2 周 | @oksai/mcp-server 核心框架             | M2     | ✅ 完成  |
| **阶段 3** | 第 3 周 | @oksai/mcp 入口应用 + OAuth 授权服务器 | M3, M4 | ✅ 完成  |
| **阶段 4** | 第 4 周 | 测试和文档                             | M5     | ⏸ 进行中 |

**预计总工期**: 21 天（约 4.2 周）
**当前进度**: 81% 已完成（17/21 天）
**剩余工作**: 测试优化和文档完善（约 4 天）

---

## 参考项目

本项目参考 `qauzy-backup` 以下模块的设计和实现：

-   `qauzy-backup/apps/mcp` - MCP 服务器应用
-   `qauzy-backup/apps/mcp-auth` - OAuth 授权服务器
-   `qauzy-backup/packages/mcp-server` - 核心 MCP 实现

**复用策略**:

-   ✅ 复用架构设计和代码模式
-   ✅ 复用传输层和工具注册框架
-   ❌ 不迁移 323 个 Gauzy 业务工具
-   ⚠️ 需要重构（TypeORM → MikroORM，`@gauzy/*` → `@oksai/*`）

---

## 技术栈

| 类别         | 技术                      | 版本  |
| ------------ | ------------------------- | ----- |
| **运行时**   | Node.js                   | 22+   |
| **语言**     | TypeScript                | 5.9+  |
| **Web 框架** | NestJS                    | 11.x  |
| **ORM**      | MikroORM                  | 6.x   |
| **数据库**   | PostgreSQL                | 16+   |
| **MCP SDK**  | @modelcontextprotocol/sdk | 1.13+ |
| **JWT 库**   | jose                      | 6.x   |

完整技术栈请参考 [技术方案文档](./TECHNICAL_PROPOSAL.md#5-技术选型)。

---

## 风险管理

### 高优先级风险

| 风险                    | 严重性 | 应对措施                              |
| ----------------------- | ------ | ------------------------------------- |
| OAuth 2.0 实现复杂性    | 🔴 高  | 实现简化版，使用 jose 库              |
| TypeORM → MikroORM 迁移 | 🔴 高  | 参考 @oksai/core 实现，只迁移必要部分 |

### 中优先级风险

| 风险             | 严重性 | 应对措施          |
| ---------------- | ------ | ----------------- |
| 时间估算偏差     | 🟡 中  | 预留 20% 缓冲时间 |
| 测试覆盖率不达标 | 🟡 中  | 测试驱动开发      |

完整风险管理请参考 [开发计划文档](./DEVELOPMENT_PLAN.md#7-风险管理)。

---

## 快速导航

| 问题           | 文档                                               | 章节     |
| -------------- | -------------------------------------------------- | -------- |
| 了解整体架构？ | [技术方案](./TECHNICAL_PROPOSAL.md#3-技术架构设计) | 架构设计 |
| 查看详细任务？ | [开发计划](./DEVELOPMENT_PLAN.md#3-详细任务分解)   | 任务分解 |
| 了解每日计划？ | [开发计划](./DEVELOPMENT_PLAN.md#4-每周计划)       | 每周计划 |
| 查看进度跟踪？ | [开发计划](./DEVELOPMENT_PLAN.md#6-进度跟踪)       | 进度跟踪 |
| 了解技术选型？ | [技术方案](./TECHNICAL_PROPOSAL.md#5-技术选型)     | 技术选型 |
| 了解成功标准？ | [技术方案](./TECHNICAL_PROPOSAL.md#8-成功标准)     | 成功标准 |

---

## 版本历史

| 文档     | 版本 | 日期       | 说明                          |
| -------- | ---- | ---------- | ----------------------------- |
| 本文档   | v1.1 | 2026-02-10 | 更新 OAuth 授权服务器完成状态 |
| 技术方案 | v1.0 | 2025-02-09 | 初始版本                      |
| 开发计划 | v1.1 | 2026-02-10 | 更新进度跟踪和里程碑状态      |
| 进度文档 | v1.0 | 2025-02-09 | 初始版本                      |

---

## 问题反馈

如有问题或建议，请：

1. 提交 Issue 到项目仓库
2. 联系技术负责人进行讨论
3. 在 Pull Request 中提出改进建议

---

**文档维护**: 本文档随项目进展持续更新
**最后更新**: 2026-02-10
