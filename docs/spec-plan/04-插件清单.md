# 插件清单

**版本**: 1.0.0
**创建日期**: 2026-02-07
**文档类型**: 插件系统
**状态**: 部分实施（以代码为准）

---

## 文档概述

本文档列出 OKSAI SAAS 服务端框架第一阶段的插件清单，包括系统插件和业务插件。

---

## 目录

1. [插件分类](#1-插件分类)
2. [系统插件清单](#2-系统插件清单)
3. [业务插件清单](#3-业务插件清单)
4. [插件依赖关系](#4-插件依赖关系)
5. [插件配置示例](#5-插件配置示例)

---

## 1. 插件分类

### 1.1 插件类型 (PluginType)

| 类型     | 代码     | 描述                             | 可用操作               |
| -------- | -------- | -------------------------------- | ---------------------- |
| 系统插件 | SYSTEM   | 必备的基础插件，受保护，不可禁用 | 无                     |
| 业务插件 | BUSINESS | 可选的业务插件，可热拔插         | 启用、禁用、重载、卸载 |

### 1.2 插件优先级 (PluginPriority)

| 优先级 | 代码 | 描述                 | 加载顺序 |
| ------ | ---- | -------------------- | -------- |
| P0     | p0   | 最高优先级，系统插件 | 最先加载 |
| P1     | p1   | 高优先级             | 第二加载 |
| P2     | p2   | 中优先级             | 第三加载 |
| P3     | p3   | 低优先级             | 最后加载 |

---

## 2. 系统插件清单

### 2.1 Auth Plugin (认证系统)

**插件名称**: @oksai/auth
**显示名称**: 认证系统
**版本**: 1.0.0
**类型**: PluginType.SYSTEM
**优先级**: PluginPriority.P0
**受保护**: true
**分类**: Authentication

**功能**:

-   用户认证（邮箱/密码）
-   第三方认证（Google, Microsoft, GitHub, Auth0）
-   JWT 令牌管理
-   令牌刷新机制
-   权限验证
-   邮箱验证

**API 端点**:

| 端点                         | 方法 | 描述                 |
| ---------------------------- | ---- | -------------------- |
| /api/auth/login              | POST | 用户登录             |
| /api/auth/register           | POST | 用户注册             |
| /api/auth/logout             | POST | 用户登出             |
| /api/auth/refresh            | POST | 刷新令牌             |
| /api/auth/me                 | GET  | 获取当前用户信息     |
| /api/auth/verify-email       | POST | 验证邮箱             |
| /api/auth/google/callback    | GET  | Google OAuth 回调    |
| /api/auth/microsoft/callback | GET  | Microsoft OAuth 回调 |
| /api/auth/github/callback    | GET  | GitHub OAuth 回调    |
| /api/auth/auth0/callback     | GET  | Auth0 OAuth 回调     |

**权限要求**: 无（公开端点）

**依赖插件**: 无

**提供的功能特性**:

-   FEATURE_AUTHENTICATION

**文件位置**:

-   `libs/auth/src/lib/auth.module.ts`
-   `libs/auth/src/lib/auth.service.ts`
-   `libs/auth/src/lib/auth.controller.ts`
-   `libs/auth/src/lib/auth.plugin.ts`

---

### 2.2 Tenant Plugin (租户管理)

**插件名称**: @oksai/tenant
**显示名称**: 租户管理
**版本**: 1.0.0
**类型**: PluginType.SYSTEM
**优先级**: PluginPriority.P0
**受保护**: true
**分类**: Infrastructure

**功能**:

-   租户 CRUD
-   租户隔离管理
-   租户配置管理
-   租户 Logo 管理
-   租户工作时长配置

**API 端点**:

| 端点                   | 方法   | 描述               |
| ---------------------- | ------ | ------------------ |
| /api/tenant            | GET    | 获取租户列表       |
| /api/tenant            | POST   | 创建租户           |
| /api/tenant/:id        | GET    | 获取租户详情       |
| /api/tenant/:id        | PATCH  | 更新租户           |
| /api/tenant/:id        | DELETE | 删除租户           |
| /api/tenant/slug/:slug | GET    | 根据 slug 获取租户 |
| /api/tenant/:id/logo   | POST   | 上传租户 Logo      |
| /api/tenant/:id/logo   | DELETE | 删除租户 Logo      |

**权限要求**:

-   `tenant:read` - 读取租户
-   `tenant:write` - 创建/更新租户
-   `tenant:delete` - 删除租户

**依赖插件**: 无

**提供的功能特性**:

-   FEATURE_MULTI_TENANCY

**文件位置**:

-   `libs/tenant/src/lib/tenant.module.ts`
-   `libs/tenant/src/lib/tenant.service.ts`
-   `libs/tenant/src/lib/tenant.controller.ts`
-   `libs/tenant/src/lib/tenant.plugin.ts`

---

### 2.3 User Plugin (用户管理)

**插件名称**: @oksai/user
**显示名称**: 用户管理
**版本**: 1.0.0
**类型**: PluginType.SYSTEM
**优先级**: PluginPriority.P0
**受保护**: true
**分类**: User Management

**功能**:

-   用户 CRUD
-   用户邀请
-   邀请管理
-   用户角色分配
-   用户激活/禁用
-   用户资料管理

**API 端点**:

| 端点                          | 方法   | 描述             |
| ----------------------------- | ------ | ---------------- |
| /api/users                    | GET    | 获取用户列表     |
| /api/users                    | POST   | 创建用户         |
| /api/users/:id                | GET    | 获取用户详情     |
| /api/users/:id                | PATCH  | 更新用户         |
| /api/users/:id                | DELETE | 删除用户         |
| /api/users/me                 | GET    | 获取当前用户信息 |
| /api/users/me                 | PATCH  | 更新当前用户信息 |
| /api/users/invite             | POST   | 邀请用户         |
| /api/users/invites            | GET    | 获取邀请列表     |
| /api/users/invites/:id        | GET    | 获取邀请详情     |
| /api/users/invites/:id/accept | POST   | 接受邀请         |
| /api/users/invites/:id/reject | POST   | 拒绝邀请         |
| /api/users/:id/role           | PATCH  | 分配角色         |

**权限要求**:

-   `users:read` - 读取用户
-   `users:write` - 创建/更新用户
-   `users:delete` - 删除用户
-   `users:invite` - 邀请用户

**依赖插件**: @oksai/tenant, @oksai/role

**提供的功能特性**:

-   FEATURE_USER_MANAGEMENT

**文件位置**:

-   `libs/user/src/lib/user.module.ts`
-   `libs/user/src/lib/user.service.ts`
-   `libs/user/src/lib/user.controller.ts`
-   `libs/user/src/lib/user.plugin.ts`

---

### 2.4 Organization Plugin (组织管理)

**插件名称**: @oksai/organization
**显示名称**: 组织管理
**版本**: 1.0.0
**类型**: PluginType.SYSTEM
**优先级**: PluginPriority.P0
**受保护**: true
**分类**: Organization Management

**功能**:

-   组织 CRUD
-   组织成员管理
-   组织配置管理
-   组织 Logo 管理
-   组织货币设置

**API 端点**:

| 端点                           | 方法   | 描述          |
| ------------------------------ | ------ | ------------- |
| /api/organizations             | GET    | 获取组织列表  |
| /api/organizations             | POST   | 创建组织      |
| /api/organizations/:id         | GET    | 获取组织详情  |
| /api/organizations/:id         | PATCH  | 更新组织      |
| /api/organizations/:id         | DELETE | 删除组织      |
| /api/organizations/:id/logo    | POST   | 上传组织 Logo |
| /api/organizations/:id/logo    | DELETE | 删除组织 Logo |
| /api/organizations/:id/members | GET    | 获取组织成员  |
| /api/organizations/:id/members | POST   | 添加组织成员  |

**权限要求**:

-   `organizations:read` - 读取组织
-   `organizations:write` - 创建/更新组织
-   `organizations:delete` - 删除组织
-   `organizations:manage_members` - 管理组织成员

**依赖插件**: @oksai/tenant, @oksai/user

**提供的功能特性**:

-   FEATURE_ORGANIZATION_MANAGEMENT

**文件位置**:

-   `libs/organization/src/lib/organization.module.ts`
-   `libs/organization/src/lib/organization.service.ts`
-   `libs/organization/src/lib/organization.controller.ts`
-   `libs/organization/src/lib/organization.plugin.ts`

---

### 2.5 Role Plugin (角色权限管理)

**插件名称**: @oksai/role
**显示名称**: 角色权限管理
**版本**: 1.0.0
**类型**: PluginType.SYSTEM
**优先级**: PluginPriority.P0
**受保护**: true
**分类**: RBAC

**功能**:

-   角色 CRUD
-   权限 CRUD
-   角色权限分配
-   用户角色分配
-   RBAC 策略实施

**API 端点**:

| 端点                                     | 方法   | 描述         |
| ---------------------------------------- | ------ | ------------ |
| /api/roles                               | GET    | 获取角色列表 |
| /api/roles                               | POST   | 创建角色     |
| /api/roles/:id                           | GET    | 获取角色详情 |
| /api/roles/:id                           | PATCH  | 更新角色     |
| /api/roles/:id                           | DELETE | 删除角色     |
| /api/permissions                         | GET    | 获取权限列表 |
| /api/permissions/:id                     | GET    | 获取权限详情 |
| /api/roles/:id/permissions               | GET    | 获取角色权限 |
| /api/roles/:id/permissions               | POST   | 分配权限     |
| /api/roles/:id/permissions/:permissionId | DELETE | 移除权限     |

**权限要求**:

-   `roles:read` - 读取角色
-   `roles:write` - 创建/更新角色
-   `roles:delete` - 删除角色
-   `permissions:read` - 读取权限
-   `permissions:write` - 分配权限

**依赖插件**: @oksai/tenant

**提供的功能特性**:

-   FEATURE_ROLES_AND_PERMISSIONS

**文件位置**:

-   `libs/role/src/lib/role.module.ts`
-   `libs/role/src/lib/role.service.ts`
-   `libs/role/src/lib/role.controller.ts`
-   `libs/role/src/lib/role.plugin.ts`

---

### 2.6 Audit Plugin (审计日志)

**插件名称**: @oksai/audit
**显示名称**: 审计日志
**版本**: 1.0.0
**类型**: PluginType.SYSTEM
**优先级**: PluginPriority.P0
**受保护**: true
**分类**: Security

**功能**:

-   操作审计记录
-   审计日志查询
-   审计日志导出
-   敏感操作追踪

**API 端点**:

| 端点              | 方法 | 描述             |
| ----------------- | ---- | ---------------- |
| /api/audit        | GET  | 获取审计日志列表 |
| /api/audit/:id    | GET  | 获取审计日志详情 |
| /api/audit/export | POST | 导出审计日志     |

**权限要求**:

-   `audit:read` - 读取审计日志

**依赖插件**: @oksai/tenant, @oksai/user

**提供的功能特性**:

-   FEATURE_AUDIT_LOG

**文件位置**:

-   `libs/audit/src/lib/audit.module.ts`
-   `libs/audit/src/lib/audit.service.ts`
-   `libs/audit/src/lib/audit.controller.ts`
-   `libs/audit/src/lib/audit.plugin.ts`

---

### 2.7 Analytics Plugin (数据分析)

**插件名称**: @oksai/analytics
**显示名称**: 数据分析
**版本**: 1.0.0
**类型**: PluginType.SYSTEM
**优先级**: PluginPriority.P0
**受保护**: true
**分类**: Analytics

**功能**:

-   事件追踪
-   指标收集
-   数据可视化
-   数据聚合
-   趋势分析

**API 端点**:

| 端点                         | 方法 | 描述         |
| ---------------------------- | ---- | ------------ |
| /api/analytics/events        | POST | 记录分析事件 |
| /api/analytics/events        | GET  | 查询分析事件 |
| /api/analytics/metrics       | POST | 记录分析指标 |
| /api/analytics/metrics       | GET  | 查询分析指标 |
| /api/analytics/reports       | GET  | 生成分析报表 |
| /api/analytics/visualization | GET  | 数据可视化   |

**权限要求**:

-   `analytics:read` - 读取分析数据
-   `analytics:write` - 写入分析数据

**依赖插件**: @oksai/tenant

**提供的功能特性**:

-   FEATURE_ANALYTICS

**文件位置**:

-   `libs/analytics/src/lib/analytics.module.ts`
-   `libs/analytics/src/lib/analytics.service.ts`
-   `libs/analytics/src/lib/analytics.controller.ts`
-   `libs/analytics/src/lib/analytics.plugin.ts`

---

### 2.8 Reporting Plugin (报表系统)

**插件名称**: @oksai/reporting
**显示名称**: 报表系统
**版本**: 1.0.0
**类型**: PluginType.SYSTEM
**优先级**: PluginPriority.P0
**受保护**: true
**分类**: Reporting

**功能**:

-   报表生成
-   报表模板管理
-   报表计划调度
-   报表导出
-   定时报表

**API 端点**:

| 端点                                 | 方法   | 描述         |
| ------------------------------------ | ------ | ------------ |
| /api/reporting/reports               | GET    | 获取报表列表 |
| /api/reporting/reports               | POST   | 创建报表     |
| /api/reporting/reports/:id           | GET    | 获取报表详情 |
| /api/reporting/reports/:id           | PATCH  | 更新报表     |
| /api/reporting/reports/:id           | DELETE | 删除报表     |
| /api/reporting/reports/:id/generate  | POST   | 生成报表     |
| /api/reporting/reports/:id/export    | GET    | 导出报表     |
| /api/reporting/templates             | GET    | 获取模板列表 |
| /api/reporting/templates             | POST   | 创建模板     |
| /api/reporting/schedules             | GET    | 获取计划列表 |
| /api/reporting/schedules             | POST   | 创建计划     |
| /api/reporting/schedules/:id         | PATCH  | 更新计划     |
| /api/reporting/schedules/:id         | DELETE | 删除计划     |
| /api/reporting/schedules/:id/enable  | POST   | 启用计划     |
| /api/reporting/schedules/:id/disable | POST   | 禁用计划     |

**权限要求**:

-   `reporting:read` - 读取报表
-   `reporting:write` - 创建/更新报表
-   `reporting:delete` - 删除报表
-   `reporting:schedule` - 管理报表计划

**依赖插件**: @oksai/tenant

**提供的功能特性**:

-   FEATURE_REPORTING

**文件位置**:

-   `libs/reporting/src/lib/reporting.module.ts`
-   `libs/reporting/src/lib/reporting.service.ts`
-   `libs/reporting/src/lib/reporting.controller.ts`
-   `libs/reporting/src/lib/reporting.plugin.ts`

---

## 3. 业务插件清单

### 3.1 预留的业务插件

以下插件建议在后续阶段作为业务插件实现：

| 插件名称         | 分类     | 优先级 | 状态 | 描述                       |
| ---------------- | -------- | ------ | ---- | -------------------------- |
| **财务插件**     | Business | P1     | 未来 | 发票、支出、收入、支付管理 |
| **任务插件**     | Business | P1     | 未来 | 任务、项目、团队管理       |
| **招聘插件**     | Business | P2     | 未来 | 候选人、面试、招聘管理     |
| **CRM 插件**     | Business | P1     | 未来 | 客户、联系人、销售管道     |
| **时间追踪插件** | Business | P1     | 未来 | 工时追踪、工时单管理       |
| **库存插件**     | Business | P2     | 未来 | 产品、库存、仓库管理       |
| **目标插件**     | Business | P2     | 未来 | 目标、KPI、OKR 管理        |
| **文档插件**     | Business | P2     | 未来 | 文档、知识库管理           |
| **聊天插件**     | Business | P3     | 未来 | 团队聊天、消息管理         |
| **日程插件**     | Business | P2     | 未来 | 日历、预约、活动管理       |

### 3.2 业务插件特性

所有业务插件具有以下特性：

-   **可热拔插**: 不需要重启应用即可加载/卸载
-   **可选功能**: 可以根据租户需求选择启用或禁用
-   **独立配置**: 每个插件有自己的配置界面
-   **权限控制**: 插件可以定义自己的权限
-   **API 扩展**: 插件可以注册自己的 API 端点
-   **数据模型**: 插件可以定义自己的数据实体
-   **UI 扩展**: 插件可以提供前端组件（预留）

---

## 4. 插件依赖关系

### 4.1 系统插件依赖图

```
@oksai/core (核心)
    ├── @oksai/database (数据库)
    └── @oksai/plugin (插件系统)

@oksai/plugin (插件系统)
    ├── @oksai/auth
    │   ├── @oksai/core
    │   ├── @oksai/plugin
    │   ├── @oksai/tenant (间接)
    │   └── @oksai/role (间接)
    │
    ├── @oksai/tenant
    │   ├── @oksai/core
    │   └── @oksai/plugin
    │
    ├── @oksai/user
    │   ├── @oksai/core
    │   ├── @oksai/plugin
    │   ├── @oksai/tenant
    │   └── @oksai/role
    │
    ├── @oksai/organization
    │   ├── @oksai/core
    │   ├── @oksai/plugin
    │   └── @oksai/tenant
    │
    ├── @oksai/role
    │   ├── @oksai/core
    │   └── @oksai/plugin
    │
    ├── @oksai/audit
    │   ├── @oksai/core
    │   ├── @oksai/plugin
    │   ├── @oksai/tenant
    │   └── @oksai/user
    │
    ├── @oksai/analytics
    │   ├── @oksai/core
    │   ├── @oksai/plugin
    │   └── @oksai/tenant
    │
    └── @oksai/reporting
        ├── @oksai/core
        ├── @oksai/plugin
        └── @oksai/tenant
```

### 4.2 依赖说明

| 插件                | 直接依赖                   | 间接依赖                   | 原因                     |
| ------------------- | -------------------------- | -------------------------- | ------------------------ |
| @oksai/auth         | @oksai/core, @oksai/plugin | @oksai/tenant, @oksai/role | 需要基础框架和插件系统   |
| @oksai/tenant       | @oksai/core, @oksai/plugin | -                          | 需要基础框架和插件系统   |
| @oksai/user         | @oksai/core, @oksai/plugin | @oksai/tenant, @oksai/role | 用户属于租户和角色       |
| @oksai/organization | @oksai/core, @oksai/plugin | @oksai/tenant              | 组织属于租户             |
| @oksai/role         | @oksai/core, @oksai/plugin | -                          | 需要基础框架和插件系统   |
| @oksai/audit        | @oksai/core, @oksai/plugin | @oksai/tenant, @oksai/user | 审计需要租户和用户上下文 |
| @oksai/analytics    | @oksai/core, @oksai/plugin | @oksai/tenant              | 分析需要租户上下文       |
| @oksai/reporting    | @oksai/core, @oksai/plugin | @oksai/tenant              | 报表需要租户上下文       |

---

## 5. 插件配置示例

### 5.1 Auth Plugin 配置

```typescript
export class AuthPlugin implements IPlugin {
	readonly name: string = 'auth';
	readonly displayName: string = '认证系统';
	readonly version: string = '1.0.0';
	readonly description: string = '提供身份认证和权限管理功能';

	readonly type: PluginType = PluginType.SYSTEM;
	readonly priority: PluginPriority = PluginPriority.P0;
	readonly category: string = 'Authentication';

	readonly author = {
		name: 'OKSAI Team',
		email: 'team@oksai.io',
		url: 'https://oksais.io'
	};

	readonly isProtected: boolean = true;
	readonly isConfigurable: boolean = true;

	readonly permissions: string[] = ['auth:login', 'auth:register', 'auth:logout', 'auth:refresh'];

	readonly api = [
		{
			path: '/api/auth/login',
			method: 'POST',
			description: '用户登录'
		},
		{
			path: '/api/auth/register',
			method: 'POST',
			description: '用户注册'
		}
		// ... 其他端点
	];

	readonly features: string[] = ['FEATURE_AUTHENTICATION'];

	readonly dependencies: string[] = [];

	async onPluginBootstrap(): Promise<void> {
		console.log('✓ Auth Plugin initialized');
	}

	async onPluginDestroy(): Promise<void> {
		console.log('✗ Auth Plugin destroyed');
	}
}
```

### 5.2 业务插件配置示例

```typescript
export class FinancePlugin implements IPlugin {
	readonly name: string = 'finance';
	readonly displayName: string = '财务管理';
	readonly version: string = '1.0.0';
	readonly description: string = '提供发票、支出、收入管理功能';

	readonly type: PluginType = PluginType.BUSINESS;
	readonly priority: PluginPriority = PluginPriority.P1;
	readonly category: string = 'Finance';

	readonly author = {
		name: 'OKSAI Team',
		email: 'team@oksai.io'
	};

	readonly isProtected: boolean = false;
	readonly isConfigurable: boolean = true;

	readonly permissions: string[] = ['finance:read', 'finance:write', 'finance:delete'];

	readonly api = [
		{
			path: '/api/finance/invoices',
			method: 'GET',
			description: '获取发票列表'
		}
		// ... 其他端点
	];

	readonly features: string[] = ['FEATURE_INVOICE', 'FEATURE_EXPENSE', 'FEATURE_INCOME'];

	readonly dependencies: string[] = ['@oksai/tenant', '@oksai/user'];

	async onPluginBootstrap(): Promise<void> {
		console.log('✓ Finance Plugin initialized');
	}

	async onPluginDestroy(): Promise<void> {
		console.log('✗ Finance Plugin destroyed');
	}
}
```

---

## 附录

### A. 插件统计

| 类型            | 数量   |
| --------------- | ------ |
| 系统插件        | 8      |
| 业务插件 (预留) | 9      |
| **总计**        | **17** |

### B. API 端点统计

| 插件                | 端点数量 |
| ------------------- | -------- |
| @oksai/auth         | 11       |
| @oksai/tenant       | 8        |
| @oksai/user         | 13       |
| @oksai/organization | 8        |
| @oksai/role         | 11       |
| @oksai/audit        | 4        |
| @oksai/analytics    | 7        |
| @oksai/reporting    | 15       |
| **总计**            | **77**   |

### C. 参考文档

-   01-技术规格文档.md - 技术规格
-   02-工作计划文档.md - 工作计划
-   03-核心实体清单.md - 实体清单

### D. 变更历史

| 版本  | 日期       | 变更内容                    |
| ----- | ---------- | --------------------------- |
| 1.0.0 | 2026-02-07 | 初始版本，列出 8 个系统插件 |

---

**文档结束**
