# OKSAI SAAS 服务端框架 - 第一阶段文档集

**版本**: 1.3.0
**创建日期**: 2026-02-07
**最后更新**: 2026-02-08
**文档类型**: 文档索引
**状态**: 进行中（以任务状态为准）

---

## 文档概述

本文档集包含 OKSAI SAAS 服务端框架第一阶段的技术规格、实施计划、实施进度与持续开发指引文档。

所有文档都基于对 `qauzy-backup` 目录下 Gauzy 项目的深入分析和简化规划。

本阶段的**评测口径**以项目宪章（`.cursor/rules/AGENTS.md`）的第一阶段目标为准，重点包括：

- **认证删减**：仅保留 Google、Microsoft、GitHub、Auth0。
- **ORM 简化**：仅使用 MikroORM，移除 TypeORM 与多 ORM 抽象层。
- **数据库模型简化**：默认 PostgreSQL，后续可扩展 MongoDB、Better-SQLite。
- **插件系统保留**：系统插件 + 可选业务插件，支持热拔插。
- **通用能力建设**：认证授权、多租户、权限、审计、配置、监控、日志。
- **组织结构对齐与复用**：新代码结构对齐 `qauzy-backup`，优先复用旧实现，避免重复造轮子。

---

## 文档列表

### 1. 技术规格文档

**文件**: `01-技术规格文档.md`

**描述**: 详细描述 OKSAI SAAS 服务端框架的技术架构、技术栈、数据库设计、插件系统架构、认证系统、多租户架构、API 设计、安全性、性能优化等核心技术规格。

**包含内容**:

-   项目概述
-   技术架构（分层架构、包依赖关系）
-   技术栈（Node.js、NestJS、MikroORM、PostgreSQL 等）
-   数据库设计（17 个核心实体的详细设计）
-   插件系统架构（分类管理、热拔插机制）
-   认证系统（JWT、第三方认证）
-   多租户架构（数据隔离）
-   API 设计（RESTful 设计、响应格式）
-   安全性（认证安全、授权安全、数据安全）
-   性能优化（数据库优化、API 优化）

**预估字数**: 约 20,000 字

---

### 2. 工作计划文档

**文件**: `02-工作计划文档.md`

**描述**: 详细描述 OKSAI SAAS 服务端框架第一阶段的工作计划，包括任务分解、时间估算、依赖关系、验收标准、里程碑等。

**包含内容**:

-   项目目标（主要目标、成功标准）
-   工作范围（包含和不包含的工作）
-   任务分解（7 个主要任务，每个任务包含子任务和详细步骤）
-   实施顺序（3 个批次，共 6 天）
-   依赖关系（任务依赖图）
-   验收标准（整体验收、各任务验收）
-   风险与缓解（技术风险、进度风险、质量风险）
-   里程碑（4 个里程碑，从核心基础完成到项目完成）

**预估工时**: 27-36 小时（约 3.5-4.5 个工作日）

**预估天数**: 6 天

---

### 3. 核心实体清单

**文件**: `03-核心实体清单.md`

**描述**: 列出 OKSAI SAAS 服务端框架第一阶段需要保留的所有核心实体，共 17 个。

**包含内容**:

-   基础实体（3 个：BaseEntity、TenantBaseEntity、TenantOrganizationBaseEntity）
-   系统实体（8 个：Tenant、User、Role、Permission、Organization、Invite、Feature、FeatureOrganization）
-   审计实体（1 个：AuditLog）
-   分析实体（2 个：AnalyticsEvent、AnalyticsMetric）
-   报表实体（3 个：Report、ReportTemplate、ReportSchedule）
-   实体关系图（核心关系图、业务关系图）
-   移除的实体（约 152 个业务实体清单，不在第一阶段范围）
-   数据库表统计（预期记录数、增长率）
-   实体统计（按类型分类的统计）

**核心实体总数**: 17 个

**移除实体数量**: 约 152 个

---

### 4. 插件清单

**文件**: `04-插件清单.md`

**描述**: 列出 OKSAI SAAS 服务端框架第一阶段的插件清单，包括 8 个系统插件和预留的 9 个业务插件。

**包含内容**:

-   插件分类（PluginType、PluginPriority 枚举定义）
-   系统插件清单（8 个：
    -   Auth Plugin（认证系统）
    -   Tenant Plugin（租户管理）
    -   User Plugin（用户管理）
    -   Organization Plugin（组织管理）
    -   Role Plugin（角色权限管理）
    -   Audit Plugin（审计日志）
    -   Analytics Plugin（数据分析）
    -   Reporting Plugin（报表系统）
    -   插件系统 API（6 个端点：status/list、列表、详情、启用、禁用、重载）
    -   插件服务（PluginRegistryService、PluginLoaderService）
    -   插件装饰器（@Plugin 装饰器）
        ）
-   业务插件清单（9 个预留：财务、任务、招聘、CRM、时间追踪、库存、目标、文档、聊天）
-   插件依赖关系（依赖图和依赖说明）
-   插件配置示例（系统插件和业务插件的配置代码示例）
-   API 端点统计（每个插件提供的端点数量）

**系统插件数量**: 8 个（✅ 已实现）

**业务插件数量**: 9 个（预留，未来实施）

**插件 API 端点**: 6 个（✅ 已实现）

**总插件数量**: 17 个

---

### 5. API 端点清单

**文件**: `05-API端点清单.md`

**描述**: 列出 OKSAI SAAS 服务端框架第一阶段所有系统插件提供的 RESTful API 端点，共 79 个。

**包含内容**:

-   API 设计原则（URL 结构、HTTP 方法、分页参数、响应格式）
-   认证 API（11 个端点：登录、注册、登出、刷新令牌、获取用户信息、第三方认证回调）
-   租户 API（5 个端点：获取列表、创建、获取详情、更新、删除）
-   用户 API（13 个端点：获取列表、创建、邀请、接受邀请等）
-   组织 API（8 个端点：获取列表、创建等）
-   角色 API（11 个端点：获取列表、创建、分配权限等）
-   审计 API（4 个端点：获取审计日志）
-   分析 API（7 个端点：记录事件、查询事件等）
-   报表 API（15 个端点：获取列表、创建、生成报表等）
-   插件 API（6 个端点：status/list、列表、详情、启用、禁用、重载）
-   状态码（成功状态码、客户端错误状态码、服务端错误状态码）
-   认证示例（JWT 认证、租户上下文示例）

**API 端点总数**: 79 个

---

### 6. 实施进度报告

**文件**: `06-实施进度报告.md`

**描述**: 记录 OKSAI SAAS 服务端框架第一阶段的实施进度、已完成的工作、遇到的问题和解决方案。

**包含内容**:

-   任务进度总览（6 个任务的完成状态）
-   任务进度总览（6 个任务的完成状态）
-   任务 2 详细进度（ORM 简化完成情况）
-   任务 3 详细进度（数据库模型简化完成情况）
-   任务 4 详细进度（插件系统完善完成情况）
-   任务 1 详细进度（Microsoft 认证完成情况）
-   任务 6 详细进度（配置与构建优化进度）
-   文档完整性
-   遇到的问题与解决方案
-   下一步计划
-   关键指标（类型错误、构建状态、任务完成率）

**当前进度**: 67%（4/6 任务完成）

**最后更新**: 2026-02-08

---

### 7. 实施总结

**文件**: `07-实施总结.md`

**描述**: 总结 OKSAI SAAS 服务端框架第一阶段的实施工作，包括完成的任务、技术成果、关键指标、风险与建议。

**包含内容**:

-   执行概述（总体进度）
-   各任务完成情况（详细说明每个任务的完成情况）
-   技术成果（ORM 简化、数据库模型简化、插件系统完善、Microsoft 认证）
-   关键指标（代码质量、任务完成率、实体统计、API 端点统计）
-   遇到的问题与解决方案（类型错误、循环依赖、配置错误、重复导入、依赖问题）
-   下一步计划（高优先级、中优先级、低优先级）
-   风险与建议
-   第一阶段成果总结

**总体进度**: 67%（4/6 任务完成）

**最后更新**: 2026-02-08

---

### 8. 开发任务清单（持续开发指引）

**文件**: `08-开发任务清单.md`

**描述**: 围绕项目宪章第一阶段目标，对照当前代码实现，提供可执行的 P0/P1/P2 任务清单、依赖关系与验收用例，用于引导继续开发。

**包含内容**:

-   目标对齐与边界说明（严格对齐 `.cursor/rules/AGENTS.md`）
-   当前现状快照（以代码与可运行性为准）
-   任务清单（P0/P1/P2）
-   验收用例（热拔插、多租户隔离、权限、审计、监控、日志）
-   推荐命令（build/lint/typecheck/test/start）

## 快速导航

### 按角色导航

#### 架构师/技术负责人

-   [技术规格文档](./01-技术规格文档.md) - 了解整体架构和技术栈
-   [核心实体清单](./03-核心实体清单.md) - 了解数据模型设计
-   [插件清单](./04-插件清单.md) - 了解插件系统架构

#### 项目经理

-   [工作计划文档](./02-工作计划文档.md) - 了解任务分解和时间估算
-   [API 端点清单](./05-API端点清单.md) - 了解 API 端点和集成需求

#### 开发人员

-   [技术规格文档](./01-技术规格文档.md) - 了解技术实现细节
-   [核心实体清单](./03-核心实体清单.md) - 了解实体字段和关系
-   [API 端点清单](./05-API端点清单.md) - 了解 API 端点和请求/响应格式
-   [开发任务清单](./08-开发任务清单.md) - 按优先级推进后续开发

#### 测试人员

-   [API 端点清单](./05-API端点清单.md) - 了解 API 端点，编写测试用例
-   [工作计划文档](./02-工作计划文档.md) - 了解测试策略和验收标准
-   [开发任务清单](./08-开发任务清单.md) - 获取验收用例清单与优先级

---

## 关键指标

### 代码规模

| 指标     | 数量 | 说明                                |
| -------- | ---- | ----------------------------------- |
| 核心实体 | 17   | 第一阶段保留的实体数量              |
| 系统插件 | 8    | 第一阶段实现的系统插件（✅ 已完成） |
| 插件 API | 6    | 插件管理 API 端点（✅ 已实现）      |
| API 端点 | 79   | 系统插件提供的 API 端点总数         |
| 包数量   | 16   | @oksai 包数量（不含 apps）          |

### 工作量预估

| 指标       | 数值       | 说明                 |
| ---------- | ---------- | -------------------- |
| 总工时     | 27-36 小时 | 所有任务的总工时     |
| 预估天数   | 6 天       | 完成第一阶段所需天数 |
| 里程碑数量 | 4 个       | 关键里程碑点         |
| 优先级     | P0-P2      | 任务优先级范围       |

### 质量目标

| 指标           | 目标值 | 说明                   |
| -------------- | ------ | ---------------------- |
| 测试覆盖率     | 80%+   | 核心业务逻辑测试覆盖率 |
| 关键路径覆盖率 | 90%+   | 关键路径测试覆盖率     |
| 类型检查       | 通过   | TypeScript 类型检查    |
| Lint           | 通过   | 代码风格检查           |

---

## 文档关系

```
文档关系图：

01-技术规格文档.md
    ├── 02-工作计划文档.md
    ├── 03-核心实体清单.md
    ├── 04-插件清单.md
    └── 05-API端点清单.md
```

-   **技术规格文档**: 定义整体架构和技术方案
-   **工作计划文档**: 基于技术规格制定实施计划
-   **核心实体清单**: 定义数据模型，对应技术规格中的数据库设计
-   **插件清单**: 定义插件系统，对应技术规格中的插件系统架构
-   **API 端点清单**: 定义 API 端点，对应技术规格中的 API 设计

---

## 使用指南

### 阅读顺序建议

#### 第一次阅读（了解整体）

1. [技术规格文档](./01-技术规格文档.md) - 从整体架构开始
2. [工作计划文档](./02-工作计划文档.md) - 了解任务分解和时间安排
3. [实施进度报告](./06-实施进度报告.md) - 了解当前实施进度

#### 第二次阅读（深入了解）

3. [核心实体清单](./03-核心实体清单.md) - 了解数据模型
4. [插件清单](./04-插件清单.md) - 了解插件系统
5. [API 端点清单](./05-API端点清单.md) - 了解 API 端点

### 开发流程

#### 开始开发前

1. 阅读技术规格文档，了解整体架构
2. 阅读核心实体清单，了解数据模型
3. 阅读工作计划文档，了解任务顺序

#### 开发过程中

1. 参考工作计划文档，按顺序执行任务
2. 参考核心实体清单，实现数据模型
3. 参考插件清单，实现插件系统
4. 参考 API 端点清单，实现 API 端点

#### 测试过程中

1. 参考工作计划文档，了解验收标准
2. 参考 API 端点清单，编写测试用例

---

## 文档更新

### 版本历史

| 版本  | 日期       | 变更内容                                                |
| ----- | ---------- | ------------------------------------------------------- |
| 1.0.0 | 2026-02-07 | 初始版本，创建 5 个核心文档                             |
| 1.1.0 | 2026-02-08 | 添加实施进度报告和实施总结，更新任务状态                |
| 1.2.0 | 2026-02-08 | 完成 Microsoft 认证集成，更新进度到 67%（4/6 任务完成） |
| 1.3.0 | 2026-02-08 | 对齐项目宪章目标口径，新增持续开发任务清单（08）        |

### 更新流程

当以下情况发生时，应更新相应文档：

1. **技术规格变更**：更新技术规格文档
2. **任务调整**：更新工作计划文档
3. **实体变更**：更新核心实体清单
4. **插件变更**：更新插件清单
5. **API 变更**：更新 API 端点清单
6. **里程碑完成**：更新本 README，记录进度

---

## 附录

### A. 参考文档

-   [AGENTS.md](../../AGENTS.md) - 代理指南和代码规范
-   [CODING_STANDARDS.md](../../CODING_STANDARDS.md) - 代码规范
-   [ARCHITECTURE.md](../../ARCHITECTURE.md) - 架构文档
-   [DATABASE_SCHEMA.md](../../DATABASE_SCHEMA.md) - 数据库架构
-   [TESTING_GUIDE.md](../../TESTING_GUIDE.md) - 测试指南

### B. 相关资源

-   qauzy-backup/ - 备份代码库，参考用
-   libs/ - 新开发的代码库
-   apps/base-api/ - 主应用

### C. 术语表

| 术语     | 定义                                                |
| -------- | --------------------------------------------------- |
| SAAS     | Software as a Service，软件即服务                   |
| ORM      | Object-Relational Mapping，对象关系映射             |
| JWT      | JSON Web Token，JSON Web 令牌                       |
| RBAC     | Role-Based Access Control，基于角色的访问控制       |
| P0-P3    | 优先级级别，P0 最高，P3 最低                        |
| DTO      | Data Transfer Object，数据传输对象                  |
| API      | Application Programming Interface，应用程序编程接口 |
| Hot-swap | 热拔插，不需要重启应用即可加载/卸载插件             |

---

## 联系与支持

### 文档维护

-   **维护者**: OKSAI Team
-   **联系方式**: team@oksai.io
-   **文档位置**: https://github.com/oksais/platform/docs/spec-plan

### 问题反馈

如果您在阅读或使用这些文档时遇到问题，请：

1. 查阅 [FAQ.md](../../FAQ.md)
2. 提交 Issue 到 GitHub: https://github.com/oksais/platform/issues
3. 联系团队: team@oksai.io

---

**文档版本**: 1.2.0
**最后更新**: 2026-02-08
**文档状态**: 进行中（67% 完成）

---

**文档结束**
